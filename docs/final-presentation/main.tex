\documentclass{beamer}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{bm}

\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{multirow}
\usepackage{natbib}

\graphicspath{{../../images/}}

\usetheme{Madrid}
\usebeamercolor{sidebartab}
\usefonttheme{professionalfonts}
\setbeamercovered{invisible}

\setbeamertemplate{caption}{\raggedright\insertcaption\par}


\title[M.Sc. Thesis 2015]{Probabilistic Modeling of City-scale Image Collections}
\author{Diego A. Ballesteros Villamizar}
\institute[ETHZ]{ETH Zürich}
\date{April 26th, 2016}

\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}

\AtBeginSection[]
{
  \begin{frame}<beamer>
    \frametitle{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\section{Introduction}

\begin{frame}{Popular Places in Zürich}
  \begin{figure}
    \centering
    \includegraphics[scale=0.35]{tripadvisor}
  \end{figure}
\end{frame}

\begin{frame}{Touristic Routes for 2 Day Trip}
  \begin{figure}
    \centering
    \includegraphics[scale=0.22]{routes_1}
  \end{figure}
\end{frame}

\begin{frame}{Related Work: Mapping the World's Photos}
  \begin{figure}\centering
    \includegraphics[scale=0.25]{kleinberg2009}
    \caption{Representative photos for top landmarks in North America identified from Flickr data. {\tiny Source: \citet{Kleinberg2009}}}
  \end{figure}
\end{frame}

\begin{frame}{Related Work: Travel Route Recommendation Using Geotags in Photo Sharing Sites}
  \begin{itemize}
    \item \citet{Kurashima2010} modeled photographer behavior by combining Markov and topic models in a probabilistic framework.
  \end{itemize}
  \begin{columns}
    \begin{column}{0.3\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{kurashima1}
        \caption{Highly photographed locations. {\tiny Source: \citet{Kurashima2010}}}
      \end{figure}
    \end{column}
    \pause
    \begin{column}{0.3\textwidth}
      \begin{align*}
        P(l_{t} \mid l_{t-1}) \\
        \sum_{z \in \bm{Z}}P(z \mid h^{u})P(l_{t} \mid z) \\
      \end{align*}
      Markov and Topic models.
    \end{column}
    \pause
    \begin{column}{0.3\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{kurashima2}
        \caption{Routes from the model. {\tiny Source: \citet{Kurashima2010}}}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Touristic Paths}
  \begin{figure}
    \centering
    \includegraphics[scale=0.22]{routes_1}
  \end{figure}
\end{frame}

\begin{frame}{Focus: Sets of Locations to Visit}
  \begin{figure}
    \centering
    \includegraphics[scale=0.45]{sets_1}
  \end{figure}
\end{frame}

\begin{frame}{Good Sets of Locations}
  \begin{columns}
    \begin{column}{0.5\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{diversity_set_1}
      \end{figure}
    \end{column}
    \begin{column}{0.5\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=.7\textwidth]{grossmunster}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Diverse Sets of Locations}
  \begin{columns}
    \begin{column}{0.5\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{diversity_set_2}
      \end{figure}
    \end{column}
    \begin{column}{0.5\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=.8\textwidth]{landesmuseum}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Diverse Sets of Locations}
  \begin{figure}
    \centering
    \includegraphics[width=.6\textwidth]{diversity_set_3}
  \end{figure}
\end{frame}

\begin{frame}{Diversity and Submodularity}
  \begin{itemize}
    \item $F(\{$ETH | Framünster$\}) \geq F(\{$ETH | UZH, Framünster$\})$.
    \item Maximizing $F(S)$ for $S$ of fixed size implies adding locations of different types $\rightarrow$ Diversity.
  \end{itemize}
\end{frame}

\begin{frame}{Complementary Sets of Locations}
  \begin{figure}
    \centering
    \includegraphics[width=.6\textwidth]{coherent_set}
  \end{figure}
\end{frame}

\begin{frame}{Complementarity and Supermodularity}
  \begin{itemize}
    \item Suppose a function $F(S)$ that counts 1 for each pair of repeated location types in $S$.
    \item For example, $F(\{$ETH, UZH, Fraumünster$\}) = 1$, $F(\{$ETH, Fraumünster$\}) = 0$.
    \item Maximizing $F(S)$ for $S$ of fixed size implies adding locations of the same types $\rightarrow$ Complementarity.
  \end{itemize}
\end{frame}

\begin{frame}{Goal}
  Model tourist behavior as probability distributions over sets of locations visited.
\end{frame}


\begin{frame}{Probabilistic Submodular Models}
  \begin{itemize}
    \item Probabilistic Submodular Models (PSMs) are a class of distributions over the powerset of a set $V$ of the form
      \begin{equation*}
      P(S) = \frac{\exp{F(S)}}{Z}
      \end{equation*}
     for all $S \subseteq V$,  where F(S) is submodular or supermodular.
   
     \item Inference in these distributions is hard. Exact computation of $Z$ is \#P-complete.
     \item Inferences has been recently studied by \cite{djolonga15scalable} and \cite{gotovos15sampling}.
  \end{itemize}
\end{frame}

\begin{frame}{Learning PSMs}
  \begin{itemize}
    \item We applied these distributions to a dataset of geotagged photographs.
    \item \citet{tschiatschek16learning} studied learning a PSM from data, i.e. estimating the model parameters.
    \item Noise Contrastive Estimation was used as an alternative for learning the PSM.
  \end{itemize}
\end{frame}

\begin{frame}{Noise Contrastive Estimation}
  \begin{itemize}
    \item Transform the task of estimating a distribution into a supervised classification task.
    \item Noise samples $\mathcal{N}$ are drawn from a known normalized distribution $P_{n}$ and contrasted with the data samples $\mathcal{D}$ assumed to come from a distribution $P_{d}$.
  \end{itemize}
\end{frame}

\section{Facility Location Diversity}

\begin{frame}{Submodular Model for Diversity}
  \begin{itemize}
    \item This is the general form of the Facility Location Diversity (FLID) model proposed by \citet{tschiatschek16learning}.
    \item A submodular function for diversity,
      \begin{equation*}
        F(S) = u(S) + D(S)
      \end{equation*}
    where $u(S)$ aggregates the utility of the items in $S$ and $D(S)$ quantifies the diversity of the items in $S$.
   \item The corresponding PSM is:
     \begin{equation*}
       P(S) = \frac{1}{Z}\exp{\left(u(S) + D(S)\right)}
     \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Aggregating Utility}
  \begin{itemize}
    \item A modular function
      \begin{equation*}
        u(S) = \sum_{i \in S}u_{i}
      \end{equation*}
    where $u_{i}$ represents the utility of each item $i$ in the ground set $V$.
    \item For example, the utility of a location could be the number of users that have taken photos of it.
  \end{itemize}
\end{frame}

\begin{frame}{Quantifying Diversity}
  \begin{itemize}
    \item A submodular function
    \only<1>{
      \begin{equation*}
        D_{d}(S) = \max_{i \in S}w_{i,d} - \sum_{i \in S}w_{i,d}
      \end{equation*}
    }
    \only<2>{
      \begin{equation*}
        D(S) = \sum_{d=1}^{L}\left(\max_{i \in S}{w_{i,d} - \sum_{i \in S}w_{i,d}}\right)
      \end{equation*}
    }
    where $w_{i}$ quantifies the contribution of item $i$ to some concept $d$ related to the diversity of the set.
    \only<1>{
      \item For example, for the concept "is a museum" locations may have binary weights $w_{d} \in \{0,1\}$. Then a set with many museums is penalized with a negative value of $D_{d}(S)$
    }
    \only<2>{
      \item FLID aggregates $L$ dimensions, where each represents one of these concepts.
    }
  \end{itemize}
\end{frame}

\begin{frame}{Quantifying Diversity}
  \begin{columns}
    \begin{column}{0.48\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{fldc_toy_example_diversity_weights}
      \end{figure}
    \end{column}
    \begin{column}{0.48\textwidth}
      1. Globus in Bahnhofstrasse
      \begin{figure}
        \centering
        \includegraphics[height=.07\textheight]{globus_bahnhof}
      \end{figure}
      2. Opera house
      \begin{figure}
        \centering
        \includegraphics[height=.07\textheight]{zurich_opera}
      \end{figure}
      3. Globus Am Bellevue
      \begin{figure}
        \centering
        \includegraphics[height=.07\textheight]{globus_bellevue}
      \end{figure}
      4. Landesmuseum
      \begin{figure}
        \centering
        \includegraphics[height=.07\textheight]{landesmuseum}
      \end{figure}
    \end{column}
  \end{columns}
  
\end{frame}

\begin{frame}{FLID}
  \begin{equation*}
    P(S) = \frac{1}{Z}\exp{\left(\sum_{i \in s} u_{i} + \sum_{d=1}^{L}\left(\max_{i \in S}{w_{i,d} - \sum_{i \in S}w_{i,d}}\right)\right)}
  \end{equation*}
  \begin{itemize}
    \item Learning can be performed efficiently, in $\mathcal{O}(|\mathcal{D} \cup \mathcal{N}|L\kappa)$ where $\kappa = \argmax_{S \in \mathcal{D} \cup \mathcal{N}}|S|$.
  \end{itemize}
\end{frame}

\section{Beyond Diversity: FLDC}

\begin{frame}{A Different Perspective}
  \begin{columns}
    \begin{column}{0.48\textwidth}
       1. Globus in Bahnhofstrasse
       \begin{figure}
         \centering
         \includegraphics[height=.2\textheight]{globus_bahnhof}
       \end{figure}
       2. Landesmuseum
       \begin{figure}
         \centering
         \includegraphics[height=.2\textheight]{landesmuseum}
       \end{figure}
    \end{column}
    \begin{column}{0.48\textwidth}
      3. Globus Am Bellevue
      \begin{figure}
        \centering
        \includegraphics[height=.2\textheight]{globus_bellevue}
      \end{figure}
      4. Opera house
      \begin{figure}
        \centering
        \includegraphics[height=.2\textheight]{zurich_opera}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Quantifiying Complementarity}
  \begin{figure}
    \centering
    \includegraphics[height=.8\textheight]{fldc_toy_example_mixed_weights_pres}
  \end{figure}
\end{frame}

\begin{frame}{Facility Location Diversity and Complementarity}
  \begin{itemize}
    \item We propose extending FLID with a supermodular term.
      \begin{equation*}
        P(S) = \frac{1}{Z}\exp{\left(u(S) + D(S) - \sum_{c=1}^{K}\left(\max_{i \in S}{w^{e}_{i,c}} - \sum_{i \in S}w^{e}_{i,c}\right)\right)}
      \end{equation*}
   \item Learning complexity is only increased by a factor of $K$.
  \end{itemize}
\end{frame}

\begin{frame}{Experimental Setup: Data and Clustering}
  \begin{columns}
    \begin{column}{0.45\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{zurich_feature_map_2015}
        \caption{Geotagged photos from Flickr.}
      \end{figure}
    \end{column}
    \begin{column}{0.45\textwidth}
      \begin{figure}
        \centering
        \includegraphics[width=\textwidth]{top_100_zurich}
        \caption{Top photographed locations.}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Experimental Setup: Completing Sets}
  \begin{itemize}
    \item Geotagged photos were grouped by user and day they were taken.
    \item Each group represents a set. Test sets are constructed by taking out one element at a time.
    \item For example, if the original set is \textit{\{Fraumünster, Grossmünster, Hauptbahnhof\}}, the test sets are:
      \begin{itemize}
        \item \textit{\{Fraumünster, Hauptbahnhof\}}
        \item \textit{\{Grossmünster, Hauptbahnhof\}}
        \item \textit{\{Fraumünster, Grossmünster\}}
      \end{itemize}
    \item The test set is $S = \{l_{1}, \dots, l_{n}\} \setminus \{l_{t}\}$.
  \end{itemize}
\end{frame}

\begin{frame}{Experimental Setup: Baselines}
  \begin{itemize}
    \item Modular
      \begin{equation*}
         \argmax_{i \notin S} u_{i}
      \end{equation*}
    \item Proximity
      \begin{equation*}
        \argmin_{i \notin S} \sum_{j \in S}d(i,j)
      \end{equation*}
    \item FLID
      \begin{equation*}
        \argmax_{i \notin S} P_{\textrm{FLID}}(S)
      \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Results - Sets}
  \begin{figure}
    \centering
    \includegraphics[width=.85\textwidth]{all_models_100_presentation_a}
  \end{figure}
\end{frame}

\begin{frame}{Experimental Setup: Baselines with Paths}
  \begin{itemize}
    \item The test path is $S_{n} = [l_{1}, \dots, l_{t-1}, l_{t+1}, \dots, l_{n}]$.
    \item Markov model
      \begin{equation*}
        \argmax_{i \in V} P(i \mid l_{t-1})P(l_{t+1} \mid i)
      \end{equation*}
    \item Heuristic Markov model
      \begin{equation*}
        \argmax_{i \notin S_{n}} P(i \mid l_{t-1})P(l_{t+1} \mid i)
      \end{equation*}
    \item Proximity ordered model
      \begin{equation*}
        \argmin_{i \notin S_{n}} d(i, l_{t-1}) + d(i, l_{t+1})
      \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Results - Paths}
  \begin{figure}
    \centering
    \includegraphics[width=.85\textwidth]{all_models_100_presentation_b}
  \end{figure}
\end{frame}

\section{Generalizing: FFLDC}

\begin{frame}{How to Generalize?}
  \begin{itemize}
    \item Is it possible to transfer knowledge about Zürich to Geneva?
    \item If new locations are identified, how can they be included in the model without learning it again?
    \item Our proposed solution: \textbf{Featurized representations}.
  \end{itemize}
\end{frame}

\begin{frame}{Featurized Facility Location Diversity and Complementarity}
  \begin{itemize}
    \item Define a feature matrix for all items in $V$, i.e. $\mathbf{X} \in \mathbb{R}^{|V| \times M}$.
    \item Factorize the model parameters $\mathbf{u}, \mathbf{W}^{b}, \mathbf{W}^{e}$
      \begin{align*}
        \mathbf{u} &= \mathbf{X}\mathbf{a} \\
        \mathbf{W^{b}} &= \mathbf{X}\mathbf{B} \\
        \mathbf{W^{e}} &= \mathbf{X}\mathbf{E}
      \end{align*}
    \item Model is then defined in the space of features, not items.
  \end{itemize}
\end{frame}

\begin{frame}{Experimental Setup: Locations}
  A smaller dataset with 10 locations.
  \begin{itemize}
    \item Hauptbahnhof
    \item Fraumünster
    \item Grossmünster
    \item Hallenstadion
    \item Prime tower
    \item Bürkliplatz
    \item Paradeplatz
    \item Bellevueplatz
    \item Rathaus
    \item Zoo
  \end{itemize}
\end{frame}

\begin{frame}{Experimental Setup: Features}
  \begin{itemize}
    \item Is it a transit station? E.g. Hauptbahnhof, Bürkliplatz.
    \item Is it a church? E.g. Fraumünster.
    \item Is it a historic building? E.g. Grossmünster, Rathaus.
    \item Is it an indoors location? E.g. Prime tower, Hallenstadion.
    \item Normalized number of photographs $n_{p}$, $\sqrt{n_{p}}$ and $\sqrt[4]{n_{p}}$.
    \item Number of users per photograph.
  \end{itemize}
\end{frame}

\begin{frame}{Results - Negative Log-likelihood}
  \begin{figure}
    \centering
    \includegraphics[width=.8\textwidth]{ffldc_10_nlog}
  \end{figure}
\end{frame}

\section{Conclusion}

\begin{frame}{Conclusions}
 \begin{itemize}
   \item We have proposed an extension of FLID to model complementarity or attractiveness in sets.
   \item Experiments in a real world application show how this can improve the quality of the model.
   \item Recommendation of tourist locations can be modeled using PSMs with positive results. However, modeling of ordered sets is an important direction to explore.
   \item We have proposed an extension of FLID to generalize the model to unseen items through features.
  \end{itemize}
\end{frame}

\begin{frame}[allowframebreaks]{References}
  \bibliographystyle{apalike}
  \bibliography{../report/bibliography/references}
\end{frame}

\end{document}
